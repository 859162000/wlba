<VirtualHost *:80>
    RewriteEngine on
    ReWriteCond %{SERVER_PORT} !^443$
    RewriteRule ^/(.*) https://%{HTTP_HOST}/$1 [NC,R,L]
</VirtualHost>

<VirtualHost *:443>

    AddType text/x-component .htc

    WSGIPassAuthorization On

    WSGIDaemonProcess staging.wanglibao.com python-path=/var/wsgi/wanglibao:/var/deploy/wanglibao/virt-python/lib/python2.7/site-packages/ user=www-data group=www-data processes=4 threads=25
    WSGIProcessGroup staging.wanglibao.com

    Alias /robots.txt /var/static/wanglibao/robots.txt
    Alias /favicon.ico /var/static/wanglibao/favicon.ico

    Alias /media/ /var/media/wanglibao/
    Alias /static/ /var/static/wanglibao/

    <Directory /var/static/wanglibao>
        Order deny,allow
        Allow from all
    </Directory>

    <Directory /var/media/wanglibao>
        Order deny,allow
        Allow from all
    </Directory>

    WSGIScriptAlias / /var/wsgi/wanglibao/wanglibao/wsgi.py

    <Directory /var/wsgi/wanglibao/wanglibao>
        Order allow,deny
        Allow from all
    </Directory>

    SSLEngine on

    SSLCertificateFile /etc/ssl/certs/wanglibao.crt
    SSLCertificateKeyFile /etc/ssl/private/wanglibao.key
    SSLCertificateChainFile /etc/ssl/certs/gd_bundle-g2-g1.crt

    Header set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</VirtualHost>
