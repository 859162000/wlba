// Generated by CoffeeScript 1.8.0
(function() {
  require.config({
    paths: {
      jquery: 'lib/jquery.min',
      'jquery.form': 'lib/jquery.form',
      'jquery.modal': 'lib/jquery.modal.min',
      tools: 'lib/modal.tools'
    },
    shim: {
      'jquery.form': ['jquery']
    }
  });

  require(['jquery', 'jquery.form', 'tools'], function($, form, tool) {
    var csrfSafeMethod, getCookie, sameOrigin;
    getCookie = function(name) {
      var cookie, cookieValue, cookies, i;
      cookieValue = null;
      if (document.cookie && document.cookie !== "") {
        cookies = document.cookie.split(";");
        i = 0;
        while (i < cookies.length) {
          cookie = $.trim(cookies[i]);
          if (cookie.substring(0, name.length + 1) === (name + "=")) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
          i++;
        }
      }
      return cookieValue;
    };
    csrfSafeMethod = function(method) {
      return /^(GET|HEAD|OPTIONS|TRACE)$/.test(method);
    };
    sameOrigin = function(url) {
      var host, origin, protocol, sr_origin;
      host = document.location.host;
      protocol = document.location.protocol;
      sr_origin = "//" + host;
      origin = protocol + sr_origin;
      return (url === origin || url.slice(0, origin.length + 1) === origin + "/") || (url === sr_origin || url.slice(0, sr_origin.length + 1) === sr_origin + "/") || !(/^(\/\/|http:|https:).*/.test(url));
    };
    $.ajaxSetup({
      beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && sameOrigin(settings.url)) {
          xhr.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
        }
      }
    });
    $('#dete-start').val($('#selectInput').val());
    $('#dete-end').val($('#selectInput1').val());
    $('#invest-money').blur(function() {
      var checkStatus, r, self, val;
      if ($('#is_no').is(':checked')) {
        self = $('#invest-money');
        val = $.trim(self.val());
        checkStatus = false;
        if (val !== '') {
          if (val < 200) {
            $('.error-style').text('投标金额不能小于200');
            checkStatus = false;
          } else {
            if (parseInt(val) > parseInt($('#invest-total').val())) {
              $('.error-style').text('投标金额必须小于账户可用余额!');
              checkStatus = false;
            } else {
              r = /^[1-9]\d*00(\.00|\.0)?$/;
              if (!r.test(val)) {
                $('.error-style').text('投标金额必须是 100 的倍数!');
                checkStatus = false;
              } else {
                $('.error-style').text('');
                checkStatus = true;
              }
            }
          }
        } else {
          $('.error-style').text('请输入投标金额');
          checkStatus = false;
        }
        return checkStatus;
      }
    });
    $('.add-ben').click(function() {
      var self, val;
      self = $('#invest-money');
      val = $.trim(self.val());
      if (val === '' || val < 100) {
        val = 100;
      }
      if (parseInt(val) + 100 <= parseInt($('#invest-total').val())) {
        self.val(parseInt(val) + 100);
        return $('.error-style').text('');
      }
    });
    $('.subtract').click(function() {
      var self, val;
      self = $('#invest-money');
      val = $.trim(self.val());
      if ($('.error-style').text() === '') {
        if (parseInt(val) - 100 >= 200) {
          return self.val(parseInt(val) - 100);
        }
      }
    });
    $('.income-range').blur(function() {
      var r, self, val;
      if ($('#is_no').is(':checked')) {
        self = $('#scope-min');
        val = $.trim(self.val());
        r = /^[0-9]*[1-9][0-9]*$/;
        if (val !== '') {
          if (!r.test(val) || !r.test($('#scope-max').val())) {
            $('.error-style').text('收益范围请输入正整数');
            return false;
          } else if (Number(val) > Number($.trim($('#scope-max').val()))) {
            $('.error-style').text('请填写正确收益范围');
            return false;
          } else if (val > 30 || $('#scope-max').val() > 30) {
            $('.error-style').text('请填写正确收益范围');
            return false;
          } else {
            return $('.error-style').text('');
          }
        } else {
          return $('.error-style').text('请填写收益范围');
        }
      }
    });
    $('.tender-ul-left li select').change(function() {
      if (Number($('#dete-start').val()) > Number($('#dete-end').val())) {
        $('.error-style').text('请选择正确收益期限');
        return false;
      } else {
        return $('.error-style').text('');
      }
    });
    return $('#submit').click(function() {
      var isNo, tip;
      isNo = $('#is_no').is(':checked');
      if (isNo) {
        $('#invest-money').blur();
        if ($('.error-style').text() === '') {
          $('.income-range').blur();
        }
        if (Number($('#dete-start').val()) > Number($('#dete-end').val()) || ($('#dete-start').val() === null || $('#dete-end').val() === null)) {
          $('.error-style').text('请选择正确收益期限');
          return false;
        }
      } else {
        $('.error-style').text('');
      }
      if ($('.error-style').text() === '') {
        if ($('#agree').is(':checked')) {
          if (isNo) {
            tip = "您将开启自动投标";
          } else {
            tip = "您将关闭自动投标";
          }
          return tool.modalConfirm({
            title: '温馨提示',
            msg: tip,
            callback_ok: function() {
              return $('#tenderForm').ajaxSubmit(function(data) {
                $('.error-style').text(data.message);
                if (data.ret_code === 0) {
                  if (isNo) {
                    $('#submit').text("关闭");
                    $('#is_no').prop('checked', false);
                    return $('#status').text("自动投标已开启");
                  } else {
                    $('#submit').text("开启");
                    $('#is_no').prop('checked', true);
                    return $('#status').text("自动投标已关闭");
                  }
                }
              });
            }
          });
        } else {
          return alert('请同意协议');
        }
      }
    });
  });

}).call(this);

//# sourceMappingURL=account_auto-tender.js.map
