// Generated by CoffeeScript 1.7.1
(function() {
  require.config({
    paths: {
      jquery: 'lib/jquery.min',
      underscore: 'lib/underscore-min',
      knockout: 'lib/knockout-3.0.0'
    }
  });

  require(['jquery', 'underscore', 'knockout', 'lib/backend', 'model/pager', 'model/table'], function($, _, ko, backend, pager, table) {
    return $(document).ready(function() {
      var DataViewModel, viewModel;
      DataViewModel = (function() {
        function DataViewModel() {
          var self;
          self = this;
          self.trustTable = new table.viewModel({
            columns: [
              {
                name: '序号',
                colspan: 1,
                text: function(item, index) {
                  return index + 1;
                }
              }, {
                name: '名称',
                colspan: 4,
                text: function(item) {
                  return item.name;
                }
              }, {
                name: '资金门槛',
                colspan: 2,
                sortable: true,
                text: function(item) {
                  return item.investment_threshold + '万';
                },
                field: 'investment_threshold'
              }, {
                name: '产品期限',
                colspan: 2,
                sortable: true,
                text: function(item) {
                  return item.period + '个月';
                },
                field: 'period'
              }, {
                name: '预期收益',
                colspan: 2,
                sortable: true,
                text: function(item) {
                  return item.expected_earning_rate.toFixed(2) + '%';
                },
                field: 'expected_earning_rate'
              }, {
                name: '投资行业',
                colspan: 2,
                sortable: true,
                text: function(item) {
                  return item.usage;
                },
                field: 'usage'
              }, {
                name: '信托分类',
                colspan: 2,
                sortable: true,
                text: function(item) {
                  return item.type;
                },
                field: 'type'
              }, {
                name: '信托公司',
                colspan: 2,
                sortable: true,
                text: function(item) {
                  return item.issuer_short_name;
                },
                field: 'issuer_short_name'
              }, {
                name: '',
                colspan: 2,
                text: function(item) {
                  return '<a class="button button-mini button-yellow" href="/trust/detail/' + item.id + '">详情</a>';
                }
              }
            ],
            events: {
              sortHandler: function(column, order) {
                var field;
                field = column.field;
                if (order === 'dsc') {
                  field = '-' + field;
                }
                return self.orderBy(field);
              }
            }
          });
          self.orderBy = ko.observable();

          /*
          Pager
           */
          self.pager = new pager.viewModel();

          /*
          The filters
           */
          self.activeFilters = ko.observableArray([]);
          self.isFilterActive = function(value) {
            return self.activeFilters.indexOf(value) >= 0;
          };
          self.clickOnFilter = function(value, event) {
            var context;
            context = ko.contextFor(event.target);
            if (self.activeFilters.indexOf(value) >= 0) {
              return;
            }
            _.each(context.$parent.values, function(value) {
              return self.activeFilters.remove(value);
            });
            self.activeFilters.push(value);
            return self.pager.currentPageNumber(1);
          };
          self.filters = [
            {
              name: '资金门槛',
              values: [
                {
                  name: '不限',
                  values: null
                }, {
                  name: '50万以下',
                  values: [
                    {
                      max_threshold: 50
                    }
                  ]
                }, {
                  name: '50-100万',
                  values: [
                    {
                      max_threshold: 100,
                      min_threshold: 50
                    }
                  ]
                }, {
                  name: '100-300万',
                  values: [
                    {
                      min_threshold: 100,
                      max_threshold: 300
                    }
                  ]
                }
              ]
            }, {
              name: '产品期限',
              values: [
                {
                  name: '不限',
                  values: null
                }, {
                  name: '12个月以下',
                  values: [
                    {
                      max_period: 12
                    }
                  ]
                }, {
                  name: '12-24个月',
                  values: [
                    {
                      min_period: 12,
                      max_period: 24
                    }
                  ]
                }, {
                  name: '24-36个月',
                  values: [
                    {
                      min_period: 24,
                      max_period: 36
                    }
                  ]
                }, {
                  name: '36个月以上',
                  values: [
                    {
                      min_period: 36
                    }
                  ]
                }
              ]
            }, {
              name: '预期收益',
              values: [
                {
                  name: '不限',
                  values: null
                }, {
                  name: '8%以下',
                  values: [
                    {
                      max_rate: 8
                    }
                  ]
                }, {
                  name: '8%-10%',
                  values: [
                    {
                      min_rate: 8,
                      max_rate: 10
                    }
                  ]
                }, {
                  name: '10%-15%',
                  values: [
                    {
                      min_rate: 10,
                      max_rate: 15
                    }
                  ]
                }, {
                  name: '15%以上',
                  values: [
                    {
                      min_rate: 15
                    }
                  ]
                }
              ]
            }, {
              name: '收益分配',
              values: [
                {
                  name: '不限',
                  values: null
                }, {
                  name: '按月付息',
                  values: [
                    {
                      payment: '按月付息'
                    }
                  ]
                }, {
                  name: '按季付息',
                  values: [
                    {
                      payment: '按季付息'
                    }
                  ]
                }, {
                  name: '半年付息',
                  values: [
                    {
                      payment: '半年付息'
                    }
                  ]
                }, {
                  name: '按年付息',
                  values: [
                    {
                      payment: '按年付息'
                    }
                  ]
                }, {
                  name: '到期付息',
                  values: [
                    {
                      payment: '到期付息'
                    }
                  ]
                }
              ]
            }, {
              name: '抵(质)押率',
              values: [
                {
                  name: '不限',
                  values: null
                }, {
                  name: '30%以下',
                  values: [
                    {
                      max_mortgage_rate: 30
                    }
                  ]
                }, {
                  name: '30%-50%',
                  values: [
                    {
                      min_mortgage_rate: 30,
                      max_mortgage_rate: 50
                    }
                  ]
                }, {
                  name: '50%以上',
                  values: [
                    {
                      min_mortgage_rate: 50
                    }
                  ]
                }
              ]
            }, {
              name: '投资行业',
              values: [
                {
                  name: '不限',
                  values: null
                }, {
                  name: '房地产',
                  values: [
                    {
                      usage: '房地产'
                    }
                  ]
                }, {
                  name: '金融',
                  values: [
                    {
                      usage: '金融'
                    }
                  ]
                }, {
                  name: '基础设施',
                  values: [
                    {
                      usage: '基础设施'
                    }
                  ]
                }, {
                  name: '工厂企业',
                  values: [
                    {
                      usage: '工厂企业'
                    }
                  ]
                }, {
                  name: '工矿企业',
                  values: [
                    {
                      usage: '工矿企业'
                    }
                  ]
                }, {
                  name: '其他',
                  values: [
                    {
                      usage: '其他'
                    }
                  ]
                }
              ]
            }, {
              name: '信托公司',
              width: '2',
              fieldName: 'issuer_short_name',
              values: [
                {
                  name: '不限',
                  values: null
                }, {
                  name: '中信信托'
                }, {
                  name: '长安信托'
                }, {
                  name: '华信信托'
                }, {
                  name: '新华信托'
                }, {
                  name: '新时代信托'
                }, {
                  name: '湖南信托'
                }, {
                  name: '天融信托'
                }, {
                  name: '天津信托'
                }, {
                  name: '中行信托'
                }, {
                  name: '四川信托'
                }, {
                  name: '苏州信托'
                }, {
                  name: '更多'
                }
              ]
            }
          ];
          _.each(self.filters, function(value) {
            return self.activeFilters.push(value.values[0]);
          });
          ko.computed(function() {
            var filters, params;
            filters = _.chain(self.activeFilters()).pluck('values').flatten().compact().value();
            params = _(filters).reduce((function(result, object) {
              return _.extend(result, object);
            }), {
              page: self.pager.currentPageNumber(),
              ordering: self.orderBy()
            });
            return backend.loadData('trusts', params).done(function(data) {
              self.trustTable.data(data.results);
              return self.pager.totalPageNumber(data.num_pages);
            }).fail(function(xhr, status, error) {
              return alert(status + error);
            });
          }).extend({
            throttle: 1
          });
        }

        return DataViewModel;

      })();
      viewModel = new DataViewModel();
      return ko.applyBindings(viewModel);
    });
  });

}).call(this);

//# sourceMappingURL=trust_products.map
