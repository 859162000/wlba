// Generated by CoffeeScript 1.8.0
(function() {
  require.config({
    paths: {
      jquery: 'lib/jquery.min'
    }
  });

  require(['jquery'], function($) {
    var Y, data, date, day, day_index, fmoney, gotime, init, m, mon, shuju, wei, wei2;
    init = function(time) {
      var csrfSafeMethod, getCookie, sameOrigin;
      csrfSafeMethod = void 0;
      getCookie = void 0;
      sameOrigin = void 0;
      getCookie = function(name) {
        var cookie, cookieValue, cookies, i;
        cookie = void 0;
        cookieValue = void 0;
        cookies = void 0;
        i = void 0;
        cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          cookies = document.cookie.split(';');
          i = 0;
          while (i < cookies.length) {
            cookie = $.trim(cookies[i]);
            if (cookie.substring(0, name.length + 1) === name + '=') {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
            i++;
          }
        }
        return cookieValue;
      };
      csrfSafeMethod = function(method) {
        return /^(GET|HEAD|OPTIONS|TRACE)$/.test(method);
      };
      sameOrigin = function(url) {
        var host, origin, protocol, sr_origin;
        host = void 0;
        origin = void 0;
        protocol = void 0;
        sr_origin = void 0;
        host = document.location.host;
        protocol = document.location.protocol;
        sr_origin = '//' + host;
        origin = protocol + sr_origin;
        return url === origin || url.slice(0, origin.length + 1) === origin + '/' || url === sr_origin || url.slice(0, sr_origin.length + 1) === sr_origin + '/' || !/^(\/\/|http:|https:).*/.test(url);
      };
      $.ajaxSetup({
        beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && sameOrigin(settings.url)) {
            xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));
          }
        }
      });
      shuju(time);
    };
    fmoney = function(s, n) {
      var i, l, r, t;
      n = n > 0 && n <= 20 ? n : 2;
      s = parseFloat((s + '').replace(/[^\d\.-]/g, '')).toFixed(n) + '';
      l = s.split('.')[0].split('').reverse();
      r = s.split('.')[1];
      t = '';
      i = 0;
      while (i < l.length) {
        t += l[i] + ((i + 1) % 3 === 0 && i + 1 !== l.length ? ',' : '');
        i++;
      }
      return t.split('').reverse().join('');
    };
    shuju = function(time) {
      $("#dan li").not(":first").remove();
      return $.ajax({
        url: '/api/investment_history/',
        data: {
          day: time
        },
        type: 'POST'
      }).done(function(data) {
        var Y, date, day, j, m, str;
        data = JSON.parse(data);
        date = new Date();
        Y = date.getFullYear();
        m = date.getMonth() + 1;
        day = date.getDate();
        if (day < 10) {
          day = '0' + day;
        }
        date = Y + '-0' + m + "-" + day;
        j = 0;
        str = '';
        if (date !== time) {
          while (j < 10) {
            if (data[0]['tops_len'] === 0) {
              str += '<li class="color9"><span class="span-one"></span><span class="span-two">－－</span><span class="span-three">－－</span></li>';
            }
            if (data[0]['tops_len'] !== 0) {
              if (data[0]['tops_len'] === 1) {
                if (j < data[0]['tops_len']) {
                  str += '<li><span class="span-one"></span><span class="span-two">' + data[0]['tops'][j]['phone'] + '</span><span class="span-three">' + fmoney(data[0]['tops'][j]['amount_sum']) + ' 元</span></li>';
                } else {
                  str += '<li class="color9"><span class="span-one"></span><span class="span-two">－－</span><span class="span-three">－－</span></li>';
                }
              } else {
                if (j < data[0]['tops_len']) {
                  str += '<li><span class="span-one"></span><span class="span-two">' + data[0]['tops'][j]['phone'] + '</span><span class="span-three">' + fmoney(data[0]['tops'][j]['amount_sum']) + ' 元</span></li>';
                } else {
                  str += '<li class="color9"><span class="span-one"></span><span class="span-two">－－</span><span class="span-three">－－</span></li>';
                }
              }
            }
            j++;
          }
        } else {
          while (j < 10) {
            if (data[0]['tops_len'] === 0) {
              str += '<li class="color6"><span class="span-one"></span><span class="span-two">虚位以待</span><span class="span-three">虚位以待</span></li>';
            }
            if (data[0]['tops_len'] !== 0) {
              if (data[0]['tops_len'] === 1) {
                if (j < data[0]['tops_len']) {
                  str += '<li><span class="span-one"></span><span class="span-two">' + data[0]['tops'][j]['phone'] + '</span><span class="span-three">' + fmoney(data[0]['tops'][j]['amount_sum']) + ' 元</span></li>';
                } else {
                  str = '<li class="color6"><span class="span-one"></span><span class="span-two">虚位以待</span><span class="span-three">虚位以待</span></li>';
                }
              } else {
                if (j < data[0]['tops_len']) {
                  str += '<li><span class="span-one"></span><span class="span-two">' + data[0]['tops'][j]['phone'] + '</span><span class="span-three">' + fmoney(data[0]['tops'][j]['amount_sum']) + ' 元</span></li>';
                } else {
                  str += '<li class="color6"><span class="span-one"></span><span class="span-two">虚位以待</span><span class="span-three">虚位以待</span></li>';
                }
              }
            }
            j++;
          }
        }
        if (str !== '') {
          $('#dan').html('<li class="day-user-hight"><span class="span-one">榜单</span><span class="span-two">用户</span><span class="span-three">投标金额</span></li>');
          return $('#dan').append(str);
        }
      });
    };
    data = new Date();
    Y = data.getFullYear();
    m = data.getMonth() + 1;
    day = data.getDate();
    if (day < 10) {
      day = '0' + day;
    }
    date = Y + '-0' + m + "-" + day;
    selectSpanFun(m, day);
    day_index = m - 3;
    init(date);
    $('#left-h1').html(+m + '月' + day + '日用户榜单');
    wei = new Date();
    wei2 = new Date();
    wei2.setMonth(2);
    wei2.setDate(24);
    wei2.setHours(0);
    wei2.setMinutes(0);
    wei2.setSeconds(0);
    gotime = wei2.getTime() - wei.getTime();
    setTimeout(function() {
      $('.ing li').eq(1).addClass('ing-hight');
      return $('.day-head h1').eq(1).addClass('h1-hight');
    }, gotime);
    mon = 0;
    $('.right-btn').on('click', function() {
      day_index++;
      if (day_index < $('.day-yue').length) {
        mon = day_index + 3;
        $('.mon').html(mon + ' 月');
        return $('.day-long').animate({
          'left': -369 * day_index + 'px'
        }, 500);
      } else {
        return day_index = 6;
      }
    });
    $('.left-btn').on('click', function() {
      day_index--;
      if (day_index >= 0) {
        mon = day_index + 3;
        $('.mon').html(mon + ' 月');
        return $('.day-long').animate({
          'left': -369 * day_index + 'px'
        }, 500);
      } else {
        return day_index = 0;
      }
    });
    $('.day-yue span').on('click', function() {
      var d, time, zm;
      m = parseInt($('.mon').text());
      d = $(this).text();
      if (d.length < 2) {
        d = '0' + d;
      }
      time = '2015-0' + m + '-' + d;
      data = new Date();
      Y = data.getFullYear();
      zm = data.getMonth() + 1;
      day = data.getDate();
      if (day < 10) {
        day = '0' + day;
      }
      date = Y + '-0' + zm + "-" + day;
      if (time >= '2015-01-14' && time <= '2015-07-15' && time <= date) {
        $(this).addClass('tap-hight2').siblings().removeClass('tap-hight2');
        $(this).parent().siblings().children('span').removeClass('tap-hight2');
        $('#left-h1').html(+m + '月' + d + '日用户榜单');
        return shuju(time);
      }
    });
    $('.day-list').on('click', function() {
      if (!$('.day-list').hasClass('curr')) {
        $('.day-list').addClass('curr');
        $('.day-list-div').show();
        $('.history-list-div').hide();
        return $('.history-list').removeClass('curr');
      }
    });
    return $('.history-list').on('click', function() {
      if (!$('.history-list').hasClass('curr')) {
        $('.history-list').addClass('curr');
        $('.history-list-div').show();
        $('.day-list-div').hide();
        return $('.day-list').removeClass('curr');
      }
    });
  });

}).call(this);

//# sourceMappingURL=list_day.js.map
