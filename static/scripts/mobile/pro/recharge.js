webpackJsonp([4],[function(t,e,n){(function(t){"use strict";var e=function(){function t(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(l){r=!0,a=l}finally{try{!i&&s["return"]&&s["return"]()}finally{if(r)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=n(5),r=n(4),a=n(2),o=n(3),s=n(8);!function(){var n=t("button[type=submit]"),l=t("input[name=amount]"),c=t("input[name='card_no']"),u=t(".recharge-loding"),d=t(".recharge-main"),h=t("input[name=validate_code]"),f=t("button[name=validate_operation]"),p=t(".bank-txt-name"),v=null,y=null,m=null,w=function(t){var e=[{target:l,required:!0}];t&&e.push({target:h,required:!0});var r=new i.Automatic({submit:n,checklist:e,done:function(){P&&f.attr("disabled",!0)}});r.operationClear()},g=function(){return new Promise(function(t,n){function i(){var t=[{type:"isEmpty",value:l.val()},{type:"isMoney",value:l.val()}];return(0,o.check)(t)}var r=i(),s=e(r,2),c=s[0],u=s[1];return c?t({message:"验证成功",amount:l.val()}):((0,a.signModel)(u),console.log("验证失败"))})},b=function(){return new Promise(function(t,n){function i(){var t=[{type:"isEmpty",value:l.val()},{type:"isMoney",value:l.val()}];return(0,o.check)(t)}var r=i(),s=e(r,2),c=s[0],u=s[1];return c?t({message:"验证成功",amount:l.val()}):((0,a.signModel)(u),console.log("验证失败"))})},k=function(t){return new Promise(function(e,n){(0,a.Confirm)("充值金额为"+t,"确认充值",function(){e(t)})})},_=function(){(0,r.ajax)({url:"/api/profile/",type:"GET",success:function(t){v=!!t.trade_pwd_is_set}})},x=function(t,e){(0,r.ajax)({url:"/api/trade_pwd/",type:"post",data:{action_type:1,new_trade_pwd:e},success:function(e){t.loadingHide(),t.destroy(),t.layoutHide(),0==e.ret_code&&s.Deal_ui.show_alert("success",function(){window.location=window.location.href},"交易密码设置成功，请牢记！"),e.ret_code>0&&(0,a.Alert)(e.message)}})},S=function O(e){function i(){var i=new s.Trade({header:"请输入交易密码",explain:"充值金额<br>￥"+e,done:function(e){i.loadingShow();var r={data:{},beforeSend:function(){n.attr("disabled",!0).text("充值中..")},success:function(e){return 0==e.ret_code?t(".sign-main").css("display","-webkit-box").find(".balance-sign").text(e.amount+"元"):30047==e.ret_code?s.Deal_ui.show_entry(e.retry_count,function(){O.layoutShow()}):30048==e.ret_code?s.Deal_ui.show_lock("取消","找回密码","交易密码已被锁定，请3小时后再试",function(){window.location="/weixin/trade-pwd/back/?next=/weixin/recharge/"}):3===e.ret_code?(0,a.Alert)("单卡超过单笔支付限额 "):e.ret_code>0?(0,a.Alert)(e.message):void 0},error:function(t){t.status>=403&&(0,a.Alert)("服务器繁忙，请稍后再试")},complete:function(t){t&&(t.loadingHide(),t.destroy(),t.layoutHide()),n.removeAttr("disabled").text("充值")}};if(y){if(!m)return i.loadingHide(),i.destroy(),i.layoutHide(),(0,a.signModel)("请获取短信码");r.data={phone:"",vcode:h.val(),order_id:m.order_id,token:m.token,trade_pwd:e.password,mode:"qpay_with_sms"},H(r,i)}else r.data={phone:"",card_no:c.attr("data-bank"),amount:l.val(),gate_id:c.attr("data-id"),trade_pwd:e.password},M(r,i)}});i.layoutShow()}function r(){function t(){var t=new s.Trade({header:"设置交易密码",explain:"请再次确认交易密码",done:function(e){return o.password_2=e.password,o.password_2!=o.password_1?(t.destroy(),t.layoutHide(),s.Deal_ui.show_alert("error",function(){r()})):(t.loadingShow(),void x(t,e.password))}});t.layoutShow()}var e=new s.Trade({header:"设置交易密码",explain:"请设置6位数字作为交易密码",done:function(n){var i=/^\d{6}$/;return o.password_1=n.password,i.test(n.password)?(e.destroy(),e.layoutHide(),void t()):(0,a.signModel)("请设置6位数字作为交易密码")}});e.layoutShow()}v?i():r();var o={}},$=null,A=function(e){var n=e.no.slice(0,6)+"********"+e.no.slice(-4);u.hide(),d.show(),$=e,l.attr("placeholder","该银行单笔限额"+e.bank.bank_limit.second_one/1e4+"万元"),c.val(n).attr({"data-bank":e.no.slice(0,6)+e.no.slice(-4),"data-id":e.bank.gate_id}),p.text(e.bank.name),e.need_validation_for_qpay?(t(".wx-input-double").show(),w(!0),y=!0):w(!1)},C=function(){(0,r.ajax)({url:"/api/pay/cnp/list_new/",type:"POST",success:function(e){return 0===e.ret_code&&(u.hide(),0===e.cards.length?t(".unbankcard").show():t(".bankcard").show()),e.ret_code>0&&20071!=e.ret_code?(0,a.Alert)(e.message):void 0},error:function(t){return(0,a.Alert)("系统异常，请稍后再试")}})},E=function(){(0,r.ajax)({url:"/api/pay/the_one_card/",type:"get",success:function(t){A(t),_()},error:function(t){403===t.status&&C()}})},M=function(t,e){(0,r.ajax)({type:"POST",url:"/api/pay/deposit_new/",data:t.data,beforeSend:function(){t.beforeSend&&t.beforeSend()},success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)},complete:function(){t.complete&&t.complete(e)}})},H=function(t,e){(0,r.ajax)({type:"POST",url:"/api/pay/cnp/dynnum_new/",data:t.data,beforeSend:function(){t.beforeSend&&t.beforeSend()},success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)},complete:function(){t.complete&&t.complete(e)}})},P=null,j=function(t){return new Promise(function(e,n){var i=function(){return t>1?(t--,f.text(t+"秒后可重发")):(clearInterval(P),P=null,f.text("重新获取").removeAttr("disabled"),n("倒计时失效，请重新获取"))};return i(),P=setInterval(i,1e3)})};E(),f.on("click",function(){b().then(function(t){var e={data:{card_no:c.attr("data-bank"),amount:l.val(),gate_id:c.attr("data-id"),mode:"vcode_for_qpay"},beforeSend:function(){f.attr("disabled","disabled").text("发送中..")},success:function(t){if(0==t.ret_code){(0,a.signModel)("短信已发送，请注意查收！"),m={token:t.token,order_id:t.order_id};var e=60;return j(e)["catch"](function(t){return(0,a.signModel)(t)})}},error:function(t){var e=JSON.parse(t.responseText);return f.removeAttr("disabled").text("获取验证码"),clearInterval(P),P=null,(0,a.signModel)(e.message)}};return M(e)})["catch"](function(t){(0,a.signModel)(t)})}),n.on("click",function(){g().then(function(t){return console.log("验证成功，充值金额为"+t.amount),k(t.amount)}).then(function(t){S(t)})["catch"](function(t){(0,a.Alert)(t)})})}()}).call(e,n(1))},,function(t,e,n){(function(t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Alert=function(e,n){var i=t(".wx-alert"),r=t(".wx-submit");i.css("display","-webkit-box").find(".wx-text").text(e),r.on("click",function(){i.hide(),n()})},e.Confirm=function(e){var n=arguments.length<=1||void 0===arguments[1]?"确定":arguments[1],i=arguments.length<=2||void 0===arguments[2]?null:arguments[2],r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],a=t(".confirm-warp");a.length<=0||(a.show(),a.find(".confirm-text").text(e),a.find(".confirm-certain").text(n),a.find(".confirm-cancel").on("click",function(){a.hide()}),a.find(".confirm-certain").on("click",function(){a.hide(),i&&(r?i(r):i())}))},e.signModel=function(e){t(".error-sign").html(e).removeClass("moveDown").addClass("moveDown").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){t(this).removeClass("moveDown")})}}).call(e,n(1))},function(t,e,n){(function(t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(l){r=!0,a=l}finally{try{!i&&s["return"]&&s["return"]()}finally{if(r)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=(e.check=function(e){var r=null,a=null;return t.each(e,function(t,e){var o=i[e.type](e.value),s=n(o,2);return r=s[0],a=s[1],r?void 0:!1}),[r,a]},{phone:function r(e){var r=parseInt(t.trim(e)),n="请输入正确的手机号",i=new RegExp(/^(12[0-9]|13[0-9]|15[0123456789]|18[0123456789]|14[57]|17[0123456789])[0-9]{8}$/);return i.test(r)?[!0,""]:[!1,n]},password:function(e){var n="密码为6-20位数字/字母/符号/区分大小写";return 6<=t.trim(e).length&&t.trim(e).length<=20?[!0,""]:[!1,n]},rePassword:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.psw,n=void 0===e?null:e,i=t.repeatPsw,r=void 0===i?null:i,a="两次密码不相同";return n!==r?[!1,a]:[!0,""]},tranPassword:function(e){var n="交易密码为6位数字",i=new RegExp(/^\d{6}$/);return i.test(t.trim(e))&&!isNaN(t.trim(e))?[!0,""]:[!1,n]},bankCard:function(e){var n="银行卡号不正确",i=new RegExp(/^\d{12,20}$/);return i.test(t.trim(e))&&!isNaN(t.trim(e))?[!0,""]:[!1,n]},idCard:function(e){var n="身份证号不正确",i=new RegExp(/^([0-9]{17}([0-9]|x|X){1})|([0-9]{15})$/);return i.test(t.trim(e))?[!0,""]:[!1,n]},money100:function(t){var e="请输入100的倍数金额";return t%100===0?[!0,""]:[!1,e]},isEmpty:function(t){var e="请填写全部的表单";return""===t?[!1,e]:[!0,""]},isMoney:function(t){var e="请正确填写金额",n=1*t;return!isNaN(n)&&n>0?[!0,""]:[!1,e]}})}).call(e,n(1))},,function(t,e,n){(function(t){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();e.Automatic=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=t.submit,r=void 0===n?null:n,a=t.checklist,o=void 0===a?[]:a,s=t.otherlist,l=void 0===s?[]:s,c=t.done,u=void 0===c?null:c;i(this,e);var d=[r,l,o,u];this.submit=d[0],this.otherlist=d[1],this.checklist=d[2],this.callback=d[3],this.allCheck=this.allRequire(),this.canSubmit=this.canSubmit.bind(this),this.isEmptyString=this.isEmptyString.bind(this),this.isEmptyArray=this.isEmptyArray.bind(this),this.check()}return r(e,[{key:"allRequire",value:function(){var t=[].concat(n(this.checklist),n(this.otherlist));return t.filter(function(t){return!!t.required})}},{key:"isEmptyArray",value:function(t){return 0===t.length}},{key:"isEmptyString",value:function(t){return""==t}},{key:"check",value:function(){if(this.isEmptyArray(this.checklist))return console.log("checklist is none");var t=this,e=null;this.checklist.forEach(function(n){var i="select"===n.target.attr("type")?"change":"input";n.target.on(i,function(){t.style(n.target),e=t.canSubmit(),t.callback&&t.callback(e)})})}},{key:"style",value:function(e){var n=this.isEmptyString(e.val()),i=e.attr("data-icon"),r=e.attr("data-other"),a=e.attr("data-operation");n&&(""!=i&&e.siblings("."+i).removeClass("active"),""!=r&&t("."+r).attr("disabled","true"),""!=a&&e.siblings("."+a).hide()),n||(""!=i&&e.siblings("."+i).addClass("active"),""!=r&&t("."+r).removeAttr("disabled"),""!=a&&e.siblings("."+a).show())}},{key:"canSubmit",value:function(){var t="text|tel|password|select|",e=this,n=this.allCheck.every(function(n){var i=n.target;return t.indexOf(i.attr("type"))>=0?!e.isEmptyString(i.val()):t.indexOf(n.target)<0?"checkbox"==i.attr("type")&&i.prop("checked")?!0:0==n.target.length:void 0});return n?this.submit.removeAttr("disabled"):this.submit.attr("disabled","true"),n}},{key:"operationClear",value:function(){t(".wx-clear-input").on("click",function(){t(this).siblings("input").val("").trigger("input")})}},{key:"operationPassword",value:function(){t(".wx-password-operation").on("click",function(){var e=t(this).siblings("input").attr("type");"text"==e&&(t(this).siblings().attr("type","password"),t(this).addClass("wx-hide-password").removeClass("wx-show-password")),"password"==e&&(t(this).siblings().attr("type","text"),t(this).addClass("wx-show-password").removeClass("wx-hide-password"))})}}]),e}()}).call(e,n(1))},,,function(t,e,n){(function(t){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();e.Trade=function(){function e(){var i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=i.header,a=void 0===r?"交易密码":r,o=i.explain,s=void 0===o?"充值金额":o,l=i.done,c=void 0===l?null:l;n(this,e);var u=[a,s,c];this.header=u[0],this.explain=u[1],this.done=u[2],this.$layout=t(".tran-warp"),this.$digt=t(".six-digt-password"),this.$input=null,this.password=null,this.rectangleWidth=null,this.hash=this.hash.bind(this),this.createInput=this.createInput.bind(this),this.rectangleShow=this.rectangleShow.bind(this),this.rectangleHide=this.rectangleHide.bind(this),this.layoutHide=this.layoutHide.bind(this),this.callback=this.callback.bind(this),this.build(),this.render()}return i(e,[{key:"hash",value:function r(){var r=Math.random().toString(36).substr(2);return t("#"+r).length>0?this.hash():r}},{key:"createInput",value:function(){var e=this.hash(),n="<input type='tel' name="+e+" style='opacity:0;' id="+e+" oncontextmenu='return false' value='' onpaste='return false' oncopy='return false' oncut='return false' autocomplete='off'  maxlength='6' minlength='6' />";this.$layout.append(n),this.$input=t("#"+e)}},{key:"render",value:function(){var e=this;t(".head-title").html(this.header),t(".tran-sign").html(this.explain),this.createInput(),this.$layout.find(".tran-close").one("click",function(){e.layoutHide()}),this.$digt.on("click",function(t){e.$input.focus(),e.rectangleFixed("click"),t.stopPropagation()}),this.$input.on("input",function(){e.rectangleFixed("input")}),t(document).on("click",function(){e.$digt.find("i").removeClass("active"),e.rectangleHide()})}},{key:"build",value:function(){this.$input&&this.$input.off("input"),t(document).off("click"),this.$digt.off("click").find("i").removeClass("active"),this.$layout.find(".circle").hide()}},{key:"destroy",value:function(){this.$input.val(""),this.$digt.find("i").removeClass("active"),t(".six-digt-password i ").find(".circle").hide()}},{key:"rectangleFixed",value:function(e){var n=this.$input.val().length,i=this.rectangleWidth*n;t(".circle").hide();for(var r=0;n>r;r++)t(".six-digt-password i ").eq(r).find(".circle").show();this.password=this.$input.val(),this.rectangleShow(),6==n&&(i=5*this.rectangleWidth),this.$layout.find(".blue").animate({translate3d:i+"px, 0 , 0"},0),6==n&&(this.$digt.find("i").removeClass("active"),"input"==e&&(this.rectangleHide(),this.$input.blur(),this.callback())),this.$digt.find("i").eq(n).addClass("active").siblings("i").removeClass("active")}},{key:"rectangleShow",value:function(){return this.rectangleWidth=Math.floor(this.$layout.find(".blue").width()),this.$layout.find(".blue").css("visibility","visible")}},{key:"rectangleHide",value:function(){return this.$layout.find(".blue").css("visibility","hidden")}},{key:"loadingShow",value:function(){return this.$layout.find(".tran-loading").css("display","-webkit-box")}},{key:"loadingHide",value:function(){return this.$layout.find(".tran-loading").css("display","none")}},{key:"layoutShow",value:function(){return this.$layout.show()}},{key:"layoutHide",value:function(){return this.$layout.hide()}},{key:"callback",value:function(){this.done&&this.done({password:this.password})}}]),e}(),e.Deal_ui={show_alert:function(e,n,i){t(".tran-alert-error").show().find("."+e).show().siblings().hide(),i&&t(".tran-alert-error").show().find("."+e).find("p").html(i),t(".tran-alert-error").find(".alert-bottom").one("click",function(){t(".tran-alert-error").hide(),n&&n()})},show_entry:function(e,n){t(".tran-alert-entry").show().find(".count_pwd").html(e),t(".tran-alert-entry").find(".alert-bottom").one("click",function(){t(".tran-alert-entry").hide(),n&&n()})},show_lock:function(e,n,i,r){t(".tran-alert-lock").show(),t(".lock-close").html(e).one("click",function(){t(".tran-alert-lock").hide()}),t(".tran-alert-lock").find(".tran-dec-entry").html(i),t(".lock-back").html(n).one("click",function(){r&&r()})}}}).call(e,n(1))}]);