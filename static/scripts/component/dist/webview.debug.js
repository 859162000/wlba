var pubsub={};!function(a){var b={},c=-1;a.publish=function(a,c){return b[a]?(setTimeout(function(){for(var d=b[a],e=d?d.length:0;e--;)d[e].func(a,c)},0),!0):!1},a.subscribe=function(a,d){b[a]||(b[a]=[]);var e=(++c).toString();return b[a].push({token:e,func:d}),e}}(pubsub);var wlb=function(pubsub){function Mixin(a){this.bridge=a}function getMixin(a){return void 0===unique&&(unique=new Mixin(a)),unique}function ready(a){function b(){Mixin.isAPP()?window.WebViewJavascriptBridge?c({callback:"app",data:WebViewJavascriptBridge}):document.addEventListener("WebViewJavascriptBridgeReady",function(){c({callback:"app",data:WebViewJavascriptBridge})},!1):c({callback:"other",data:null})}function c(b){var c;f&&pubsub.publish("log",{type:"success",message:"当前执行环境为:"+b.callback}),b.callback&&"app"==b.callback&&(c=getMixin(b.data),f&&d(c),c._init());try{f&&pubsub.publish("log",{type:"success",message:"执行回调:"+b.callback}),a[b.callback](c)}catch(e){f&&pubsub.publish("log",{type:"error",message:"异常:"+b.callback})}}function d(a){for(var b in a)!function(b){var c=a[b];"function"==typeof c&&(a[b]=function(d,e){return pubsub.publish("log",{type:"success",message:"开始动作:"+b+"\n接收参数:\ndata:"+d+"\ncallback:"+e}),c.call(a,d,e)})}(b)}function e(b){var c=a.debug.host;c=""==c?"localhost":c;try{var d=new WebSocket("ws://"+c+":3000");d.onopen=function(){pubsub.subscribe("log",function(a,b){d.send(JSON.stringify({type:b.type,message:b.message}))}),b&&b()},d.onmessage=function(a){var b=JSON.parse(a.data);alert(b.message)}}catch(e){console.log("当前环境无法调试，请在本地局域网内")}}var f=a.debug?a.debug["switch"]||!1:!1;f&&e(b),f||b()}var unique;return Mixin.isAPP=function(){var a=navigator.userAgent;return a.indexOf("wlbAPP")>-1},Mixin.filterJSON=function(target){var u=navigator.userAgent,toString=Object.prototype.toString,newJSON=target;if(u.indexOf("Android")>-1&&"[object String]"==toString.call(newJSON))try{newJSON=eval("("+target+")")}catch(e){return newJSON}return newJSON},Mixin.prototype={_init:function(){this.bridge.init(function(a,b){var c={init:"true"};b(c)})},_setData:function(a,b){var c={post:{},callback:null},d=Object.prototype.toString;if("[object Object]"==d.call(a))for(var e in a)c.post[e]=a[e];return"[object Function]"==d.call(a)?(c.callback=a,c):(c.callback="[object Function]"==d.call(b)?b:null,c)},loginApp:function(a,b){var c=this._setData(a,b);this.bridge.callHandler("loginApp",c.post,function(a){c.callback&&c.callback(a)})},registerApp:function(a,b){var c=this._setData(a,b);this.bridge.callHandler("registerApp",c.post,function(a){c.callback&&c.callback(a)})},firstLoadWebView:function(a,b){var c=this._setData(a,b);this.bridge.callHandler("firstLoadWebView",c.post,function(a){c.callback&&c.callback(a)})},jumpToManageMoney:function(a){this.bridge.callHandler("jumpToManageMoney",function(b){a&&a(b)})},jumpToDiscoverView:function(a){this.bridge.callHandler("jumpToDiscoverView",function(b){a&&a(b)})},authenticated:function(a,b){var c=this._setData(a,b);this.bridge.callHandler("authenticated",c.post,function(a){var b=Mixin.filterJSON(a);c.callback&&c.callback(b)})},shareData:function(a){this.bridge.registerHandler("shareData",function(b,c){c(a)})},touchShare:function(a,b){var c=this._setData(a,b);this.bridge.callHandler("touchShare",c.post,function(a){var b=Mixin.filterJSON(a);c.callback&&c.callback(b)})},shareStatus:function(a){this.bridge.registerHandler("shareStatus",function(b,c){var d=Mixin.filterJSON(b);a&&a(d)})},sendUserInfo:function(a,b){var c=this._setData(a,b);this.bridge.callHandler("sendUserInfo",{},function(a){var b=Mixin.filterJSON(a);c.callback&&c.callback(b)})}},{ready:ready}}(pubsub);